generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id            Int           @id @default(autoincrement())
  email         String        @unique
  first_name    String
  last_name     String?
  password      String
  profile_image String?
  balance       Float         @default(0)
  created_at    DateTime      @default(now())
  updated_at    DateTime      @updatedAt

  transactions  Transaction[]

  @@map("users")
}

model Banner {
  id           Int      @id @default(autoincrement())
  banner_name  String
  banner_image String
  description  String
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt

  @@map("banners")
}

model Service {
  id             Int      @id @default(autoincrement())
  service_code   String   @unique
  service_name   String
  service_icon   String
  service_tariff Float    // Diubah dari service_tarif ke service_tariff dan tipe data Float
  created_at     DateTime @default(now())
  updated_at     DateTime @updatedAt

  transactions   Transaction[]

  @@map("services")
}

model Transaction {
  id              Int              @id @default(autoincrement())
  invoice_number  String           @unique
  user_id         Int
  service_code    String?          // Bisa null untuk transaksi TOPUP
  transaction_type TransactionType 
  description     String
  total_amount    Float
  created_at     DateTime @default(now())
  updated_at     DateTime @updatedAt
  
  // Relasi yang diperbaiki - nama model harus sesuai
  user            User             @relation(fields: [user_id], references: [id], onDelete: Cascade)
  service         Service?         @relation(fields: [service_code], references: [service_code])
  
  @@map("transactions")
  @@index([user_id])
  @@index([created_on(sort: Desc)])
  @@index([invoice_number])
}

enum TransactionType {
  TOPUP
  PAYMENT
}